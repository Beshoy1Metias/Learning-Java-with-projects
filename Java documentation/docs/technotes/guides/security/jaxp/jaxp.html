<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang=
"en-us">
<head>
<meta http-equiv="Content-Type" content=
"text/html; charset=us-ascii" />
<meta content=
"The JDK and Java XML APIs have been improved over the years with various measures and tools that can help prevent applications from being exploited by XML-related attacks. This guide shows you how to use the secure processing features of Java API for XML Processing (JAXP) to safeguard your applications and systems." />
<meta content=
"The JDK and Java XML APIs have been improved over the years with various measures and tools that can help prevent applications from being exploited by XML-related attacks. This guide shows you how to use the secure processing features of Java API for XML Processing (JAXP) to safeguard your applications and systems." />
<title>Java API for XML Processing (JAXP) Security Guide</title>
<link rel="stylesheet" type="text/css" href="../../../../technotes/css/guide.css" />
</head>
<body>
<!-- STATIC HEADER -->

<!-- header start -->
<div id="javaseheader">
<div id="javaseheaderlogo">
<img src="../../../../images/javalogo.gif"
alt="Java logo" />
</div>
<div id="javaseheaderindex">

<a href=
"../../../../index.html">Documentation Contents</a>
</div>
<div class="clear"></div>
</div>

<!-- header end -->


<h1><a name="java-api-for-xml-processing-security-guide" id=
"java-api-for-xml-processing-security-guide"></a>Java API for XML
Processing (JAXP) Security Guide</h1>
<p>The JDK and Java XML APIs have been improved over the years
with various measures and tools that can help prevent
applications from being exploited by XML-related attacks. This
guide shows you how to use the secure processing features of Java
API for XML Processing (JAXP) to safeguard your applications and
systems.</p>

<h2>Topics</h2>

<ul>
  <li><a href="#potential-attacks-during-xml-processing">Potential Attacks During XML Processing</a>
    <ul>
      <li><a href="#xml-external-entity-injection-attack">XML External Entity Injection Attack</a>
        <ul>
          <li><a href="#external-resources-supported-by-xml-schema-and-xslt-standards">External Resources Supported by XML, Schema, and XSLT Standards</a></li>
        </ul>
      </li>
      <li><a href="#exponential-entity-expansion-attack">Exponential Entity Expansion Attack</a></li>
    </ul>
  </li>

  <li><a href="#configuring-jaxp-for-secure-xml-processing">Configuring JAXP for Secure XML Processing</a>
    <ul>    
      <li><a href="#jaxp-apis">JAXP APIs</a></li>
      <li><a href="#factories-and-processors">Factories and Processors</a></li>
      <li><a href="#configuring-with-jaxp-properties">Configuring with JAXP Properties</a>
        <ul>
          <li><a href="#setting-jaxp-properties-through-jaxp-factories">Setting JAXP Properties Through JAXP Factories</a></li>
          <li><a href="#setting-jaxp-properties-as-system-properties">Setting JAXP Properties as System Properties</a></li>
          <li><a href="#setting-jaxp-properties-in-a-jaxp-configuration-file">Setting JAXP Properties in a JAXP Configuration File</a></li>
          <li><a href="#scope-and-order-of-setting-jaxp-properties">Scope and Order of Setting JAXP Properties</a>
        </ul>
      </li>  
      <li><a href="#security-related-properties">Security-Related Properties</a>
        <ul>
          <li><a href="#api-defined-properties">API-Defined Properties</a>
            <ul>
              <li><a href="#the-feature-security-processing-security-directive">The FEATURE_SECURE_PROCESSING Security Directive</a>
                <ul>
                  <li><a href="#jaxp-property-precedence-and-feature-security-processing">JAXP Property Precedence and FEATURE_SECURE_PROCESSING</a></li>
                </ul>
              </li>
              <li><a href="#external-access-properties">External Access Properties</a>
                <ul>
                  <li><a href="#when-to-use-external-access-properties">When to Use External Access Properties</a></li>
                  <li><a href="#jaxp-property-precedence-and-external-access-properties">JAXP Property Precedence and External Access Properties</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#jdk-specific-properties">JDK-Specific Properties</a>
            <ul>
              <li><a href="#jaxp-properties-for-processing-limits">JAXP Properties for Processing Limits</a>
                <ul>
                  <li><a href="#legacy-system-properties">Legacy System Properties</a></li>
                  <li><a href="#feature-secure-processing-default-limitations">FEATURE_SECURE_PROCESSING Default Limitations</a></li>
                  <li><a href="#limiting-entity-expansion">Limiting Entity Expansion</a></li>
                  <li><a href="#limiting-the-number-of-element-attributes">Limiting the Number of Element Attributes</a></li>
                  <li><a href="#limiting-the-number-of-nodes-created-by-constructs-that-contain-maxoccurs">Limiting the Number of Nodes Created by Constructs That Contain maxOccurs</a></li>
                  <li><a href="#when-to-use-processing-limits">When to Use Processing Limits</a>
                    <ul>
                      <li><a href="#memory-setting-and-limits">Memory Setting and Limits</a></li>
                      <li><a href="#estimating-the-limits-using-the-getEntityCountInfo-property">Estimating the Limits Using the getEntityCountInfo Property</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li><a href="#extension-functions">Extension Functions</a></li>
              <li><a href="#third-party-parsers">Third-Party Parsers</a></li>
              <li><a href="#disabling-dtd-processing">Disabling DTD Processing</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#composite-processors">Composite Processors</a></li>
      <li><a href="#using-java-xml-resolvers">Using Java XML Resolvers</a>
        <ul>
          <li><a href="#entity-resolvers-for-sax-and-dom">Entity Resolvers for SAX and DOM</a></li>
          <li><a href="#xmlresolver-for-stax">XMLResolver for StAX</a></li>
          <li><a href="#uriresolver-for-transform">URIResolver for javax.xml.transform</a></li>
          <li><a href="#lsresource-resolver-for-validation">LSResourceResolver for javax.xml.validation</a></li>
        </ul>
      </li>
    </ul>
  </li>
    
  <li><a href="#relationship-with-security-manager">Relationship with Security Manager</a></li>
  <li><a href="#handling-errors-from-jaxp-properties">Handling Errors from JAXP Properties</a></li>
  <li><a href="#streaming-api-for-xml-and-jaxp-properties">Streaming API for XML and JAXP Properties</a>
    <ul>
      <li><a href="#stax-and-processing-limits">StAX and Processing Limits</a></li>
      <li><a href="#stax-and-external-access-properties">StAX and External Access Properties</a></li>
    </ul>
  </li>
    
  <li><a href="#general-recommendations-for-jaxp-security">General Recommendations for JAXP Security</a></li>
  <li><a href="#appendix-a">Appendix A: Glossary of Java API for XML Processing Terms and Definitions</a></li>
  <li><a href="#appendix-b">Appendix B: Java and JDK XML Features and Properties Naming Convention</a></li>
</ul>
  
<!-- ####################################################### -->

<h2><a name="potential-attacks-during-xml-processing">Potential Attacks During XML Processing</a></h2>

<p>XML processing can expose applications to certain
vulnerabilities. Among the most prominent and well-known attacks
are the XML External Entity (XXE) injection attack and the
exponential entity expansion attack, also know as the XML bomb or
billion laughs attack. These attacks can potentially cause
serious damage to a system by denying its services or worse, lead
to the loss of sensitive data.</p>

<p>You should evaluate your applications' requirements and
operating environment to assess the level of potential threat,
for example, whether or to what extent the applications are
exposed to untrusted XML sources.</p>

<!-- ####################################################### -->

<h3><a name="xml-external-entity-injection-attack">XML External Entity Injection Attack</a></h3>

<p>The XML, XML Schema, and XSLT standards define a number of
structures that enable the embedding of external content in XML
documents through system identifiers that reference external
resources. In general, XML processors resolve and retrieve almost
all of these external resources; see <a href=
"#external-resources-supported-by-xml-schema-and-xslt-standards">External
Resources Supported by XML, Schema, and XSLT Standards</a> for a
list of constructs that support the inclusion of external
resources. In addition, some constructs enable the execution of
applications through external functions. XML External Entity
(XXE) injection attacks exploit XML processors that have not been
secured by restricting the external resources that it may
resolve, retrieve, or execute. This can result in disclosing
sensitive data such as passwords or enabling arbitrary execution
of code.</p>

<!-- ####################################################### -->

<h4><a name="external-resources-supported-by-xml-schema-and-xslt-standards">External Resources Supported by XML, Schema, and XSLT Standards</a></h4>

<p>XML, Schema, and XSLT standards support the following
constructs that require external resources. The default behavior
of the JDK XML processors is to make a connection and fetch the
external resources as specified.</p>

<ul>
<li>
<p>External DTD: references an external Document Type Definition
(DTD), for example:</p>
<pre>&lt;!DOCTYPE root_element SYSTEM "url"&gt;</pre></li>
<li>
<p>External Entity Reference: Refers to external data, the
following is the syntax:</p>
<pre>&lt;!ENTITY <code>name</code> SYSTEM "<code>url</code>"&gt;</pre></li>
<li>
<p>General entity reference, for example:</p>
<pre>&lt;?xml version="1.0" standalone="no" ?&gt;
&lt;!DOCTYPE doc [&lt;!ENTITY otherFile SYSTEM "otherFile.xml"&gt;]&gt;
&lt;doc&gt;
    &lt;a&gt;
        &lt;b&gt;&amp;otherFile;&lt;/b&gt;
    &lt;/a&gt;
&lt;/doc&gt;</pre></li>
<li>
<p>External Parameter Entities: The following is the syntax:</p>
<pre>&lt;!ENTITY % <code>name</code> SYSTEM <code>uri</code>&gt;</pre>
<p>The following is an example:</p>
<pre>&lt;?xml version="1.0" standalone="no"?&gt;
    &lt;!DOCTYPE doc [
      &lt;!ENTITY % ent1 SYSTEM "http://www.example.com/student.dtd"&gt;
      %ent1;
    ]&gt;</pre></li>
<li><p>XInclude: Includes an external infoset in an XML document,
for example:</p>
<pre>&lt;Book xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
    &lt;xi:include href=toc.xml"/&gt;
    &lt;xi:include href=part1.xml"/&gt;
    &lt;xi:include href=part2.xml"/&gt;
    &lt;xi:include href=index.xml"/&gt;
&lt;/Book&gt;</pre></li>
<li>
<p>References to XML Schema components using the
<code>schemaLocation</code> attribute and <code>import</code> and
<code>include</code> elements, for example:</p>
<pre>&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
    &lt;xs:include schemaLocation="http://www.example.com/schema/schema1.xsd"/&gt;
    &lt;!-- ... --&gt;
&lt;/xs:schema&gt;</pre></li>
<li><p>Combining style sheets using import or include elements, the
following is the syntax:</p>
<pre>&lt;xsl:include href="<code>include</code>.xsl"/&gt;</pre></li>
<li><p><code>xml-stylesheet</code> processing instruction: Used to
include a stylesheet in an XML document, for example:</p>
<pre>&lt;?xml-stylesheet href="include.xsl" type="text/xsl"?&gt;
</pre></li>
<li><p>XSLT <code>document()</code> function: Used to access nodes
in an external XML document, for example:</p>
<pre>&lt;xsl:variable select="document('DocumentFunc2.xml')"/&gt;</pre></li>
</ul>

<!-- ####################################################### -->

<h3><a name="exponential-entity-expansion-attack">Exponential Entity Expansion Attack</a></h3>

<p>The exponential entity expansion attack, also know as the XML
bomb or billion laughs attack, is a denial-of-service attack that
involves XML parsers. The basic exploit is to have several layers
of nested entities, each referring to a number of entities of the
next layer. The following is a sample SOAP document that contains
deeply nested entity references:</p>

<pre>&lt;?xml version="1.0" encoding ="UTF-8"?&gt;
&lt;!DOCTYPE bbb[
    &lt;!ENTITY x100 "bbb"&gt;
    &lt;!ENTITY  x99 "&amp;x100;&amp;x100;"&gt;
    &lt;!ENTITY  x98 "&amp;x99;&amp;x99;"&gt;
    ...
    &lt;!ENTITY   x2 "&amp;x3;&amp;x3;"&gt;
    &lt;!ENTITY   x1 "&amp;x2;&amp;x2;"&gt;
]&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=...&gt;
    &lt;SOAP-ENV:Body&gt;
        &lt;ns1:aaa xmlns:ns1="urn:aaa" SOAP-ENV:encodingStyle="..."&gt;
            &lt;foobar xsi:type="xsd:string"&gt;&amp;x1;&lt;/foobar&gt;
        &lt;/ns1:aaa&gt;
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</pre>

<p>When an XML parser encounters such a document, it will attempt
to resolve the entity declaration by expanding the references.
Because the references are nested, the expansion becomes
exponential by the number of entities each refers to. Such a
process can lead the XML parser to consume 100% of CPU time and a
large amount of memory, and eventually the system runs out of
memory.</p>

<!-- ####################################################### -->

<h2><a name="configuring-jaxp-for-secure-xml-processing">Configuring JAXP for Secure XML Processing</a></h2>

<p>JAXP consists of a set of APIs for parsing, serializing, transforming, querying, and traversing XML documents. See <a href="#jaxp-apis">JAXP APIs</a>.</p>

<p>JAXP adds a layer of security through factories and processors. You access APIs from JAXP through factories, which ensure that they are configured according to JAXP properties that you've set based on your security requirements. You configure and instantiate factories with their respective processors. See <a href="#factories-and-processors">Factories and Processors</a>.</p>

<p>You configure JAXP processors through JAXP properties. You can set JAXP properties through JAXP factories, as System properties, or in a JAXP configuration file. See <a href="#configuring-with-jaxp-properties">Configuring with JAXP Properties</a>.</p>

<p>The section <a href="#security-related-properties">Security-Related Properties</a> describes properties you can set to configure JAXP for secure XML processing.</p>

<p>The section <a href="#composite-processors">Composite Processors</a> describes how enabling <code>FEATURE_SECURE_PROCESSING</code> (FSP) for a composite processor such as a validator or transformer also enables FSP for any internal parser that the composite processor uses.</p>

<p>In addition, JAXP enables you to register custom resolvers, which intercept references to external resources and resolve them with local ones. This eliminates the need to read and access external resources, which helps remove a source of potential risk. See <a href="#using-java-xml-resolvers">Using Java XML Resolvers</a>.</p>

<!-- ######################################################## -->

<h3><a name="jaxp-apis">JAXP APIs</a></h3>

<p>JAXP consists of a set of APIs built XML technologies and standards that are essential for XML processing. These include APIs for the following:</p>

<ul>
  <li>Parsing: JAXP Parsing API (<a href="../../../../api/javax/xml/parsers/package-summary.html"><code>javax.xml.parsers</code></a> package, which is based on the Document Object Model (DOM) (<a href="../../../../api/"><code>org.w3c.dom</code></a> package) and Simple API for XML Parsing (SAX) (<a href="../../../../api/org/w3c/dom/package-summary.html"><code>org.xml.sax</code></a> package)</li>
  
  <li>Streaming API for XML (StAX) (<a href="../../../../api/javax/xml/stream/package-summary.html"><code>javax.xml.stream</code></a> package)</li>
  
  <li>Serializing: StAX and Extensible Stylesheet Language Transformations (XSLT) (<a href="../../../../api/javax/xml/transform/package-summary.html"><code>javax.xml.transform</code></a> package)</li>
  
  <li>Transformation: JAXP Transformation API (<a href="../../../../api/javax/xml/transform/package-summary.html"><code>javax.xml.transform</code></a> package) and XSLT (Extensible Stylesheet Language Transformations)</li>
  
  <li>Querying and traversing XML documents: XML Path Language (XPath) API (<a href="../../../../api/javax/xml/xpath/package-summary.html"><code>javax.xml.xpath</code></a> package)</li>

</ul>

<!-- ####################################################### -->

<h3><a name="factories-and-processors">Factories and Processors</a></h3>

<p>Factories are the entry points of each JAXP API. They provide methods that enable applications to set JAXP properties programmatically before creating processors. Factories also support the JAXP lookup mechanism, which enable you to deploy applications with third-party implementations instead of JDK implementations.</p>

<p>Processors are aggregates of parsers (or readers), serializers (or writers), validators, and transformers that control and perform the processing in their respective areas. Factories configure and instantiate their corresponding factories. For example, you configure and instantiate the <code>DocumentBuilder</code> and <code>SAXParser</code> processors with the <code>DocumentBuilderFactory</code> and <code>SAXParserFactory</code> factories, respectively.</p>

<!-- ####################################################### -->

<h3><a name="configuring-with-jaxp-properties">Configuring with JAXP Properties</a></h3>

<p>You configure JAXP processors through JAXP properties. The following lists the ways you can set JAXP properties in order of precedence from highest to lowest. For example, if you set a JAXP property's value through a factory, then it will override any other value set in a different way.</p>

<ul>

    <li><p><a href="#setting-jaxp-properties-through-jaxp-factories">Setting JAXP Properties Through JAXP Factories</a>: You can set a JAXP property through a JAXP factory in your code.</p></li>
    
    
    <li><p><a href="#setting-jaxp-properties-as-system-properties">Setting JAXP Properties as System Properties</a>: You can set a JAXP property like a System property by setting its value on the command line with the following syntax:</p>
    
    <pre>-D<em>&lt;property name&gt;</em>=<em>&lt;property value&gt;</em></pre>

    <p>You can also set a System property's value with the method <code>System.setProperty(String key, String name)</code> or <code>System.setProperties(Properties)</code>.</p></li>
    
    <li><p><a href="#setting-jaxp-properties-in-a-jaxp-configuration-file">Setting JAXP Properties in a JAXP Configuration File</a>: You can set a JAXP property in a user-defined JAXP configuration file named <code><em>&lt;java-home&gt;</em>/lib/jaxp.properties</code>.</p></li>
    
</ul>
<p>Note that Not all JAXP properties can be set by all of these ways.</p>

<!-- ####################################################### -->

<h4><a name="setting-jaxp-properties-through-jaxp-factories">Setting JAXP Properties Through JAXP Factories</a></h4>

<p>If you can modify your application's code, or you're creating
a new application, then setting JAXP properties through JAXP
factories or a parser is the preferred method. Set these
properties through the following interfaces:</p>

<pre>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
dbf.setAttribute(<em>name</em>, <em>value</em>);
 
SAXParserFactory spf = SAXParserFactory.newInstance();
SAXParser parser = spf.newSAXParser();
parser.setProperty(<em>name</em>, <em>value</em>);

SchemaFactory schemaFactory = SchemaFactory.newInstance(schemaLanguage);
schemaFactory.setProperty(<em>name</em>, <em>value</em>);
 
TransformerFactory factory = TransformerFactory.newInstance();
factory.setAttribute(<em>name</em>, <em>value</em>);
 
XMLInputFactory xif = XMLInputFactory.newInstance();
xif.setProperty(<em>name</em>, <em>value</em>);

XPathFactory xf = XPathFactory.newInstance();
xf.setProperty(<em>name</em>, <em>value</em>);</pre>

<p>The following is an example of setting processing limits:</p>

<pre>dbf.setAttribute("http://www.oracle.com/xml/jaxp/properties/entityExpansionLimit", "2000");

dbf.setAttribute("http://www.oracle.com/xml/jaxp/properties/maxGeneralEntitySizeLimit", "100000");

dbf.setAttribute("http://www.oracle.com/xml/jaxp/properties/maxParameterEntitySizeLimit", "10000"); 

dbf.setAttribute("http://www.oracle.com/xml/jaxp/properties/maxElementDepth", "100");

factory.setAttribute("jdk.xml.xpathTotalOpLimit", "1000"); 
xf.setProperty("jdk.xml.xpathExprGrpLimit", "20");</pre>

<p>The following is an example of limiting a DOM parser to only
local connections for external DTDs:</p>

<pre>dbf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "file, jar:file");</pre>

<p>If a parser module within the application handles untrusted
sources, it may further restrict access. The following code
overrides those in the <code>jaxp.properties</code> file and
those specified by System properties and enables the XML
processor to read local files only:</p>

<pre>DocumentBuilderFactory dbf =
DocumentBuilderFactory.newInstance();   
dbf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "file");

// ...   

SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);   
schemaFactory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "file");   
schemaFactory.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "file");</pre>

<p>As described in <a href="#scope-and-order-of-setting-jaxp-properties">Scope and Order of Setting JAXP Properties</a>, JAXP properties specified through
JAXP factories have the narrowest scope, affecting only the
processors created by the factories, and therefore override any
default settings, System properties, and those in the
<code>jaxp.properties</code> file. By setting JAXP properties
through JAXP factories, you can ensure that your applications
behave the same way regardless of which JDK release you're using
or whether JAXP properties are set through other means.</p>

<!-- ####################################################### -->

<h4><a name="setting-jaxp-properties-as-system-properties">Setting JAXP Properties as System Properties</a></h4>

<p>System properties may be useful if you can't modify your
application's code.</p>

<p>To set JAXP properties for an entire JDK invocation, set their
corresponding System properties on the command line.</p>
<p>To set JAXP properties for only a portion of the application,
set their corresponding System properties before the portion, and
then clear them afterward. For example, if your application
requires access to external DTDs and schemas, then add these
lines to your application's initialization code block:</p>

<pre>System.setProperty("javax.xml.accessExternalDTD", "file, http");
System.setProperty("javax.xml.accessExternalSchema", "file, http");</pre>

<p>Then, once your application is done processing XML documents
or before it exits, clear out the properties as follows:</p>

<pre>System.clearProperty("javax.xml.accessExternalDTD");   
System.clearProperty("javax.xml.accessExternalSchema");</pre>

<p>The following code, from <a href=
"https://docs.oracle.com/javase/tutorial/jaxp/limits/sample.html">
Processing Limit Samples</a> in <cite>The Java Tutorials</cite>, is another example that shows how to do this
for the processing limit
<code>maxGeneralEntitySizeLimit</code>:</p>

<pre>public static final String SP_GENERAL_ENTITY_SIZE_LIMIT =
    "jdk.xml.maxGeneralEntitySizeLimit";

// Set limits using System property;
// this setting will affect all processing after it's set
System.setProperty(SP_GENERAL_ENTITY_SIZE_LIMIT, "2000");

// Perform some processing here

// After it is done, clear the property
System.clearProperty(SP_GENERAL_ENTITY_SIZE_LIMIT);</pre>

<p>Note that processing limit values are integers. A
<code>NumberFormatException</code> is thrown if a processing
limit's value is not a parsable integer; see the method
<code>java.lang.Integer.parseInt(String)</code>.</p>

<p>The following example allows the resolution of external
schemas for a portion of an application:</p>

<pre>// Allow resolution of external schemas
// This setting will affect all processing after it's set
System.setProperty("javax.xml.accessExternalSchema", "file, http");

// Perform some processing here

// After it's done, clear the property
System.clearProperty("javax.xml.accessExternalSchema");</pre>

<!-- ####################################################### -->

<h4><a name="setting-jaxp-properties-in-a-jaxp-configuration-file">Setting JAXP Properties in a JAXP Configuration File</a></h4>

<p>If you want to specify a JAXP property that affects every JDK
invocation, then create a configuration file named
<code><em>&lt;java-home&gt;</em>/lib/jaxp.properties</code>
and specify names and values of JAXP properties in it, one
name-value pair on each line. For example, the following
<code>jaxp.properties</code> file sets the
<code>maxGeneralEntitySizeLimit</code> processing limit property
to 2000 and restricts access to the file and HTTP protocols for
external references set by the <code>stylesheet</code> processing
instruction, <code>document</code> function, and the
<code>import</code> and <code>include</code> elements.</p>

<pre>jdk.xml.maxGeneralEntitySizeLimit=2000
javax.xml.accessExternalStylesheet=file, http</pre>

<p>If you don't want to allow any external connection by XML
processors, you can set all access external restrictions to
<code>file</code> only:</p>

<pre>javax.xml.accessExternalDTD=file
javax.xml.accessExternalSchema=file
javax.xml.accessExternalStylesheet=file</pre>

<p>If you want to prevent applications from accidentally reading
external files through an XML processor, set the external access
restrictions as follows in the <code>jaxp.properties</code> file
as follows:</p>

<pre>javax.xml.accessExternalDTD=""   
javax.xml.accessExternalSchema=""   
javax.xml.accessExternalStylesheet=""</pre>

<p>Note:</p>

<ul>
<li>Use the corresponding System property in the
<code>jaxp.properties</code> file. Processing limit System
properties have the prefix <code>jdk.xml</code>. External access
restriction System properties have the prefix
<code>javax.xml</code>.</li>
<li>Processing limit values are integers. A
<code>NumberFormatException</code> is thrown if a processing
limit's value is not a parsable integer; see the method
<code>java.lang.Integer.parseInt(String)</code>.</li>
</ul>

<!-- ####################################################### -->

<h4><a name="scope-and-order-of-setting-jaxp-properties">Scope and Order of Setting JAXP Properties</a></h4>

<p>JAXP properties can be set in multiple ways, including through API methods, in system properties, and in the JAXP configuration file. When not explicitly set, they will be initialized with default values or more restrictive values when <code>FEATURE_SECURE_PROCESSING</code> (FSP) is enabled. The order of precedence for properties is as follows, from highest to lowest:</p>

<ul>
  <li>The APIs for factories or processors</li>
  <li>System properties</li>
  <li>The JAXP configuration file, <code><em>&lt;java-home&gt;</em>/lib/jaxp.properties</code></li>
  <li>The default values for JAXP properties; if FSP is true, then the default values will be set to process XML securely</li>
</ul>

<p>Using the <code>jdk.xml.entityExpansionLimit</code> property as an example, the following illustrates how these rules are applied:</p>

<ul>
  <li><p>Properties specified through factory or processor APIs have the highest precedence. The following code effectively sets the <code>jdk.xml.entityExpansionLimit</code> property to 2000 regardless of settings in any other configuration sources.</p>
  
<pre>DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
dbf.setAttribute("http://www.oracle.com/xml/jaxp/properties/entityExpansionLimit", "2000");</pre></li>

  <li><p>If the property is not set by the factory as in the previous example, a system property setting will be in effect. The following command-line example sets the <code>jdk.xml.entityExpansionLimit</code> property to 2000 for the application <code>myApp</code>:</p>
  
<pre>java -Djdk.xml.entityExpansionLimit=2000 myApp</pre></li>

  <li><p>If the property is not set by the factory or in a system property, the setting in the JAXP configuration file, <code><em>&lt;java-home&gt;</em>/lib/jaxp.properties</code>, will take effect. The following entry sets the <code>jdk.xml.entityExpansionLimit</code> property to 2000.</p>

  <pre>jdk.xml.entityExpansionLimit=2000</pre></li>
  
  <li><p>If the value of the <code>jdk.xml.entityExpansionLimit</code> property is not set anywhere, it will be resolved to its default value, 64000.</p></li>

</ul>


<!-- ####################################################### -->

<h3><a name="security-related-properties">Security-Related Properties</a></h3>

<p>The following sections describe the properties you can set to configure JAXP for secure XML processing. There are two kinds of JAXP security-related properties:</p>

<ul>
  <li><a href="#api-defined-properties">API-Defined Properties</a>: These are constant field values that are part of the Java SE API whose values you set through a factory's or parser's <code>setAttribute(String, Object)</code> or <code>setProperty(String, Object)</code> method. Some of these fields have corresponding system properties you can set on the command line or in a JAXP configuration file:
    <ul>
      <li><a href="#the-feature-security-processing-security-directive">The FEATURE_SECURE_PROCESSING Security Directive</a></li>
      <li><a href="#external-access-properties">External Access Properties</a></li>
    </ul>
  </li>
  <li><a href="#jdk-specific-properties">JDK-Specific Properties</a>: These are system properties you set through JAXP parsers or factories, on the command line, or in a JAXP configuration file. Some of these aren't system properties, which means you can't set their values on the command line:
    <ul>
      <li><a href="#jaxp-properties-for-processing-limits">JAXP Properties for Processing Limits</a></li>
      <li><a href="#extension-functions">Extension Functions</a></li>
      <li><a href="#third-party-parsers">Third-Party Parsers</a></li>
      <li><a href="#disabling-dtd-processing">Disabling DTD Processing</a></li>
    </ul>
  </li>
</ul>

<!-- ####################################################### -->

<h4><a name="api-defined-properties">API-Defined Properties</a></h4>

<!-- ####################################################### -->

<h5><a name="the-feature-security-processing-security-directive">The FEATURE_SECURE_PROCESSING Security Directive</a></h5>

<p>The <a href=
"../../../../api/javax/xml/XMLConstants.html#FEATURE_SECURE_PROCESSING"><code>FEATURE_SECURE_PROCESSING</code></a> (FSP) security directive signals the intent to enable security restrictions for processing XML documents. It's defined by the JAXP API and provides a standard mechanism for requesting secure mode from JAXP implementations. When it's set to true through a JAXP factory, it instructs the JAXP processor, such as a parser, to apply various restrictions based on the processor's security model, for example:</p>

<pre>factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</pre>

<p>In addition, when <code>FEATURE_SECURE_PROCESSING</code> is set to true, the JDK activates security restrictions through <a href="#external-access-properties">External Access Properties</a> (EAPs) and <a href="#jdk-specific-properties">JDK-Specific Properties</a>.</p>

<p>By default, the JDK turns FSP on for SAX, DOM, and validation.</p>

<p>Note that when a Security Manager is present, JAXP security processing is turned on automatically.</p>

<!-- ####################################################### -->

<h6><a name="jaxp-property-precedence-and-feature-security-processing">JAXP Property Precedence and FEATURE_SECURE_PROCESSING</a></h6>

<p>FSP is required for XML processors including DOM, SAX, schema validation, XSLT, and XPath.</p>

<p>When FSP is turned on, then default processing limits (see <a href="#jaxp-properties-for-processing-limits">JAXP Properties for Processing Limits</a>) are enforced. Turning off FSP does not change the limits.</p>

<p>When FSP is "explicitly" turned on through the API, for example, <code>factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)</code>, then <a href="#external-access-properties">External Access Properties</a> (EAPs) are set to the empty string, which means that no permission is granted to any protocol. Although FSP is turned on by default for DOM, SAX and schema validation, it is not treated as if "explicitly" turned on; therefore, the default value for EAPs is <code>all</code>, which means that permission is granted to all protocols.</p>

<p>When a Java Security Manager is present, FSP is turned on and cannot be turned off.</p>

<!-- ####################################################### -->

<h5><a name="external-access-properties">External Access Properties</a></h5>

<p>External Access Properties (EAPs), along
with their corresponding System properties, enable you to
regulate external connections.</p>

<p>EAPs enable you to specify the type of
external connections that can or cannot be permitted. The
property values are a list of protocols. The JAXP processors
check if a given external connection is permitted by matching the
protocol with those in the list. Processors will attempt to
establish the connection if it is on the list, or reject it if
not. Use EAPs along with custom resolvers (see
<a href="#using-java-xml-resolvers">Using Java XML Resolvers</a>)
to reduce the risk of external connections
by rejecting and resolving them with local resources.</p>

<p><strong>Note:</strong> Explicitly turning on FSP through the API, for example,
<code>factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING,
true)</code>, disables all external connections.</p>

<p>EAPs are defined
in <code>javax.xml.XMLConstants</code> as follows:</p>
<ul>
<li><a href=
"../../../../api/javax/xml/XMLConstants.html#ACCESS_EXTERNAL_DTD">
<code>javax.xml.XMLConstants.ACCESS_EXTERNAL_DTD</code></a></li>
<li><a href=
"../../../../api/javax/xml/XMLConstants.html#ACCESS_EXTERNAL_SCHEMA">
<code>javax.xml.XMLConstants.ACCESS_EXTERNAL_SCHEMA</code></a></li>
<li><a href=
"../../../../api/javax/xml/XMLConstants.html#ACCESS_EXTERNAL_STYLESHEET">
<code>javax.xml.XMLConstants.ACCESS_EXTERNAL_STYLESHEET</code></a></li>
</ul>

<!-- ####################################################### -->

<h6><a name="ACCESS_EXTERNAL_DTD">ACCESS_EXTERNAL_DTD</a></h6>

<table title="ACCESS_EXTERNAL_DTD" summary=
"The ACCESS_EXTERNAL_DTD external access restrictions JAXP property"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="h1" valign="bottom" align="left">Attribute</th>
<th id="h2" valign="bottom" align="left">Description</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h1" valign="top" align="left">Name</td>
<td headers="h2" valign="top" align="left">
<code>http://javax.xml.XMLConstants/property/accessExternalDTD</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h1" valign="top" align="left">
Definition</td>
<td headers="h2" valign="top" align="left">
Restricts access to external DTDs and external entity references
to the protocols specified.</td>
</tr>
<tr valign="top" align="left">
<td headers="h1" valign="top" align="left">Value</td>
<td headers="h2" valign="top" align="left">
See <a href="#values-of-external-access-properties">Values of External Access Properties</a></td>
</tr>
<tr valign="top" align="left">
<td headers="h1" valign="top" align="left">Default
value</td>
<td headers="h2" valign="top" align="left">
all, connection permitted to all protocols</td>
</tr>
<tr valign="top" align="left">
<td headers="h1" valign="top" align="left">System
property</td>
<td headers="h2" valign="top" align="left">
<code>javax.xml.accessExternalDTD</code></td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h6><a name="ACCESS_EXTERNAL_SCHEMA">ACCESS_EXTERNAL_SCHEMA</a></h6>

<table title="ACCESS_EXTERNAL_SCHEMA" summary=
"The ACCESS_EXTERNAL_SCHEMA external access restrictions JAXP property"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="h101" valign="bottom" align="left">Attribute</th>
<th id="h102" valign="bottom" align="left">Description</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h101" valign="top" align="left">Name</td>
<td headers="h102" valign="top" align="left">
<code>http://javax.xml.XMLConstants/property/accessExternalSchema</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h101" valign="top" align="left">
Definition</td>
<td headers="h102" valign="top" align="left">
Restricts access to the protocols specified for external
references set by the <code>schemaLocation</code> attribute,
<code>import</code> element, and <code>include</code>
element.</td>
</tr>
<tr valign="top" align="left">
<td headers="h101" valign="top" align="left">Value</td>
<td headers="h102" valign="top" align="left">
See <a href="#values-of-external-access-properties">Values of External Access Properties</a></td>
</tr>
<tr valign="top" align="left">
<td headers="h101" valign="top" align="left">Default
value</td>
<td headers="h102" valign="top" align="left">
all, connection permitted to all protocols.</td>
</tr>
<tr valign="top" align="left">
<td headers="h101" valign="top" align="left">System
property</td>
<td headers="h102" valign="top" align="left">
<code>javax.xml.accessExternalSchema</code></td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h6><a name="ACCESS_EXTERNAL_STYLESHEET">ACCESS_EXTERNAL_STYLESHEET</a></h6>

<table title="ACCESS_EXTERNAL_STYLESHEET" summary=
"The ACCESS_EXTERNAL_STYLESHEET external access restrictions JAXP property"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="h201" valign="bottom" align="left">Attribute</th>
<th id="h202" valign="bottom" align="left">Description</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h201" valign="top" align="left">Name</td>
<td headers="h202" valign="top" align="left">
<code>http://javax.xml.XMLConstants/property/accessExternalStylesheet</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h201" valign="top" align="left">
Definition</td>
<td headers="h202" valign="top" align="left">
Restricts access to the protocols specified for external
references set by the <code>stylesheet</code> processing
instruction, <code>document</code> function, and
<code>import</code> and <code>include</code> elements.</td>
</tr>
<tr valign="top" align="left">
<td headers="h201" valign="top" align="left">Value</td>
<td headers="h202" valign="top" align="left">
See <a href="#values-of-external-access-properties">Values of External Access Properties</a></td>
</tr>
<tr valign="top" align="left">
<td headers="h201" valign="top" align="left">Default
value</td>
<td headers="h202" valign="top" align="left">
all, connection permitted to all protocols.</td>
</tr>
<tr valign="top" align="left">
<td headers="h201" valign="top" align="left">System
property</td>
<td headers="h202" valign="top" align="left">
<code>javax.xml.accessExternalStylesheet</code></td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h6><a name="values-of-external-access-properties">Values of External Access Properties</a></h6>

<p>All EAPs have values of the same format:</p>
<ul>
<li>
<p><strong>Value</strong>: A list of protocols separated by
comma. A protocol is the scheme portion of an URI, or in the case
of the JAR protocol, <code>jar</code> plus the scheme portion
separated by colon. A scheme is defined as:</p>
<code><em>scheme</em> = <em>alpha</em> *( <em>alpha</em> |
<em>digit</em> | "+" | "-" | "." )</code>
<p>where <code><em>alpha</em></code> = <code>a-z</code> and
<code>A-Z</code>.</p>
The JAR protocol is defined as:
<code>jar[:<em>scheme</em>]</code>
<p>Protocols are case-insensitive. Any whitespace characters as
defined by <code>Character.isSpaceChar</code> in the value are
ignored. Examples of protocols are <code>file</code>,
<code>http</code>, and <code>jar:file</code>.</p>
</li>
<li>
<p><strong>Default value</strong>: The default value is
implementation specific. For the JDK, the default value is
<code>all</code>, which grants permissions to all protocols.</p>
</li>
<li>
<p><strong>Granting all access</strong>: The keyword
<code>all</code> grants permission to all protocols. For example,
specifying <code>javax.xml.accessExternalDTD=all</code> in the
<code>jaxp.properties</code> file enables a system to work as
before with no restrictions on accessing external DTDs and entity
references.</p>
</li>
<li>
<p><strong>Denying any access</strong>: An empty string
(<code>""</code>) means that no permission is granted to any
protocol. For example, specifying
<code>javax.xml.accessExternalDTD=""</code> in the
<code>jaxp.properties</code> file instructs JAXP processors to
deny any external connections.</p>
</li>
</ul>

<!-- ####################################################### -->

<h5><a name="when-to-use-external-access-properties">When to Use External Access Restrictions</a></h5>

<p>The XML processors, by default, attempt to connect and read external resources that are referenced in XML sources. Note that this may potentially expose applications and systems to risks posed by external connections. It's therefore recommended that applications consider limiting external connections with EAPs.</p>

<p>Internal applications and systems that handle only trusted XML documents may not need these restrictions. Applications and systems that rely on the Java Security Manager to regulate external connections may also have no need for them. However, keep in mind that EAPs are specific to the XML processors and at the top layer of the process, which means that the processors check these EAPs before any connections are made. They may therefore serve as an additional and more direct protection against external connection risks.</p>

<p>You can use EAPs along with custom resolvers and catalogs (see <a href="#using-java-xml-resolvers">Using Java XML Resolvers</a>) to effectively manage external connections and reduce risks.</p>

<p>Even in a trusted environment with trusted sources, it's recommended that you use both EAPs and resolvers to minimize dependencies on external sources.</p>

<!-- ####################################################### -->

<h5><a name="jaxp-property-precedence-and-external-access-properties">JAXP Property Precedence and External Access Properties</a></h5>

<p>EAPs have no effect on the relevant constructs that they attempt to restrict in the following situations:</p>
<ul>
    <li><p>When there is a resolver and the source returned by the resolver is not null: This applies to entity resolvers that may be set on SAX and DOM parsers, XML resolvers on StAX parsers, <code>LSResourceResolver</code> on <code>SchemaFactory</code>, a <code>Validator</code> or <code>ValidatorHandler</code>, or <code>URIResolver</code> on a transformer.</p></li>

    <li><p>When a schema is created explicitly by calling the <code>newSchema</code> method from <code>SchemaFactory</code>.</p></li>

    <li><p>When external resources are not required: For example, the following features and properties are supported by the JDK and may be used to instruct the processor to not load the external DTD or resolve external entities:</p>

<pre>http://apache.org/xml/features/disallow-doctype-decl true
http://apache.org/xml/features/nonvalidating/load-external-dtd false
http://xml.org/sax/features/external-general-entities false
http://xml.org/sax/features/external-parameter-entities false</pre></li></ul>

<!-- ####################################################### -->
      
<h4><a name="jdk-specific-properties">JDK-Specific Properties</a></h4>

<!-- ####################################################### -->

<h5><a name="jaxp-properties-for-processing-limits">JAXP Properties for Processing Limits</a></h5>

<p>XML processing can sometimes be a memory intensive operation.
Applications, especially those that accept XML, XSD and XSL from
untrusted sources, should take steps to guard against excessive
memory consumption by using JAXP properties for processing
limits.</p>

<p>Evaluate your application's requirements and operating
environment to determine the acceptable processing limits for
your system configurations and set these limits accordingly. For
example, use size-related limits to prevent malformed XML sources
from consuming large amounts of memory. Use
<code>EntityExpansionLimit</code> to enable an application to control
memory consumption under an acceptable level.</p>

<p>The JDK XML parsers observe processing limits by default. Both
DOM and SAX parsers have Feature for Secure Processing (FSP)
turned on by default and therefore turn on the limits. The StAX
parser also observes processing limits by default even though it
doesn't support FSP.</p>

<p>The JDK XML processors enable you to adjust processing limits individually in three ways:</p>
<ul>
  <li>Through standard XML APIs</li>
  <li>By using System properties</li>
  <li>In the <code>jaxp.properties</code> file</li>
</ul>

<p>See <a href="#configuring-with-jaxp-properties">Configuring with JAXP Properties</a> and <a href="#scope-and-order-of-setting-jaxp-properties">Scope and Order of Setting JAXP Properties</a>.</p>

<p>The following table describes the JAXP properties for
processing limits supported in the JDK.</p>


<table title="JAXP Processing Limit Properties" summary="JAXP Processing Limit Properties"
   frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
   border="1">
   <thead>
      <tr>
         <th id="h301" valign="bottom" align="left">Property Name</th>
         <th id="h302" valign="bottom" align="left">System Property</th>
         <th id="h303" valign="bottom" align="left">Description</th>
         <th id="h304" valign="bottom" align="left">Default Value</th>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td headers="h301"><a name="elementAttributeLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/elementAttributeLimit</code></td>
         <td headers="h302"><code>jdk.xml.elementAttributeLimit</code></td>
         <td headers="h303">Limits the number of attributes an element can
    have.</td>
         <td headers="h304">10000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="entityExpansionLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/entityExpansionLimit</code></td>
         <td headers="h302"><code>jdk.xml.entityExpansionLimit</code></td>
         <td headers="h303">Limits the number of entity expansions.</td>
         <td headers="h304">64000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="entityReplacementLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/entityReplacementLimit</code></td>
         <td headers="h302"><code>jdk.xml.entityReplacementLimit</code></td>
         <td headers="h303">Limits the total number of nodes in all entity
    references.</td>
         <td headers="h304">3000000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="maxElementDepth"/>
         <code>http://www.oracle.com/xml/jaxp/properties/maxElementDepth</code></td>
         <td headers="h302"><code>jdk.xml.maxElementDepth</code></td>
         <td headers="h303">Limits the maximum element depth.</td>
         <td headers="h304">0</td>
      </tr>
      <tr>
         <td headers="h301"><a name="maxGeneralEntitySizeLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/maxGeneralEntitySizeLimit</code></td>
         <td headers="h302"><code>jdk.xml.maxGeneralEntitySizeLimit</code></td>
         <td headers="h303">Limits the maximum size of any general entities.</td>
         <td headers="h304">0</td>
      </tr>
      <tr>
         <td headers="h301"><a name="maxOccurLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/maxOccurLimit</code></td>
         <td headers="h302"><code>jdk.xml.maxOccurLimit</code></td>
         <td headers="h303">Limits the number of content model nodes that may be
    created when building a grammar for a W3C XML Schema that contains
        <code>maxOccurs</code> attributes with values other than
    "unbounded".
         </td>
         <td headers="h304">5000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="maxParameterEntitySizeLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/maxParameterEntitySizeLimit</code></td>
         <td headers="h302"><code>jdk.xml.maxParameterEntitySizeLimit</code></td>
         <td headers="h303">Limits the maximum size of any parameter entities,
    including the result of nesting multiple parameter entities.</td>
         <td headers="h304">1000000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="maxXMLNameLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/maxXMLNameLimit</code></td>
         <td headers="h302"><code>jdk.xml.maxXMLNameLimit</code></td>
         <td headers="h303">Limits the maximum size of XML names, including element
    name, attribute name and namespace prefix and URI.</td>
         <td headers="h304">1000</td>
      </tr>
      <tr>
         <td headers="h301"><a name="totalEntitySizeLimit"/>
         <code>http://www.oracle.com/xml/jaxp/properties/totalEntitySizeLimit</code></td>
         <td headers="h302"><code>jdk.xml.totalEntitySizeLimit</code></td>
         <td headers="h303">Limits the total size of all entities that include
    general and parameter entities. The size is calculated as an aggregation
    of all entities.</td>
         <td headers="h304">5x10^7</td>
      </tr>
      <tr>
         <td headers="h301"><a name="xpathExprGrpLimit"/>
         <code>jdk.xml.xpathExprGrpLimit</code></td>
         <td headers="h302"><code>jdk.xml.xpathExprGrpLimit</code></td>
         <td headers="h303">Limits the number of groups an XPath expression can
    contain.</td>
         <td headers="h304">10</td>
      </tr>
      <tr>
         <td headers="h301"><a name="xpathExprOpLimit"/>
         <code>jdk.xml.xpathExprOpLimit</code></td>
         <td headers="h302"><code>jdk.xml.xpathExprOpLimit</code></td>
         <td headers="h303">Limits the number of operators an XPath expression can
    contain.</td>
         <td headers="h304">100</td>
      </tr>
      <tr>
         <td headers="h301"><a name="xpathTotalOpLimit"/>
         <code>jdk.xml.xpathTotalOpLimit</code></td>
         <td headers="h302"><code>jdk.xml.xpathTotalOpLimit</code></td>
         <td headers="h303">Limits the total number of XPath operators in an XSL
    Stylesheet.</td>
         <td headers="h304">100000</td>
      </tr>
   </tbody>
</table>

<!-- ####################################################### -->

<h6><a name="legacy-system-properties" id="legacy-system-properties">Legacy System Properties</a></h6>

<p>These properties, which were introduced in JDK 5.0 and 6,
continue to be supported for backward compatibility.</p>

<table title=
"Legacy System Properties Related to Processing Limits" summary=
"Lists legacy system properties related to processing limits still supported by the JDK for backward compatibility"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="h401" valign="bottom" align="left">System Property</th>
<th id="h402" valign="bottom" align="left">Since</th>
<th id="h403" valign="bottom" align="left">New System Property</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h401" valign="top" align="left">
<code>entityExpansionLimit</code></td>
<td headers="h402" valign="top" align="left">
1.5</td>
<td headers="h403" valign="top" align="left">
<code>jdk.xml.entityExpansionLimit</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h401" valign="top" align="left">
<code>elementAttributeLimit</code></td>
<td headers="h402" valign="top" align="left">
1.5</td>
<td headers="h403" valign="top" align="left">
<code>jdk.xml.elementAttributeLimit</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h401" valign="top" align="left">
<code>maxOccurLimit</code></td>
<td headers="h402" valign="top" align="left">
1.6</td>
<td headers="h403" valign="top" align="left">
<code>jdk.xml.maxOccur</code></td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h6><a name="feature-secure-processing-default-limitations">FEATURE_SECURE_PROCESSING Default Limitations</a></h6>

<p>The following table describes which XML-related factory classes are disabled and which processing limits are set if <code>FEATURE_SECURE_PROCESSING</code> (FSP) is enabled.</p>

<table cellpadding="4" cellspacing="0"
  title="Default Limitations Set by FSP on XML-Related Factory Classes"
    summary="Describes default limitations set by FSP, if enabled, on XML-related factory classes" border="1">
  <thead>
    <tr align="left" valign="top">
      <th id="h501" align="left" valign="bottom" width="20%">XML-Related Factory Class</th>
      <th id="h502" align="left" valign="bottom" width="10%">Enabled?</th>
      <th id="h503" align="left" valign="bottom" width="70%">Processing Limits</th>
    </tr>
  </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td headers="h501" align="left" valign="top" width="20%"><code>DocumentBuilderFactory</code></td>
                                          <td headers="h502" align="left" valign="top" width="10%">true</td>
                                          <td headers="h503" align="left" valign="top" width="70%">
                                             <code>jdk.xml.entityExpansionLimit = 64000</code><br/>
                                             <code>jdk.xml.elementAttributeLimit = 1000</code><br/>
                                             <code>jdk.xml.maxOccurLimit = 5000</code>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td headers="h501" align="left" valign="top" width="20%"><code>SAXParserFactory</code></td>
                                          <td headers="h502" align="left" valign="top" width="10%">true</td>
                                          <td headers="h503" align="left" valign="top" width="70%">
                                             <code>jdk.xml.entityExpansionLimit = 64000</code><br/>
                                             <code>jdk.xml.elementAttributeLimit = 10000</code><br/>
                                             <code>jdk.xml.maxOccurLimit = 5000</code>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td headers="h501" align="left" valign="top" width="20%"><code>SchemaFactory</code></td>
                                          <td headers="h502" align="left" valign="top" width="10%">true</td>
                                          <td headers="h503" align="left" valign="top" width="70%">
                                              <code>jdk.xml.maxOccurLimit = 5000</code>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td headers="h501" align="left" valign="top" width="20%"><code>TransformerFactory</code></td>
                                          <td headers="h502" align="left" valign="top" width="10%">false</td>
                                          <td headers="h503" align="left" valign="top" width="70%">Extension functions disabled</td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td headers="h501" align="left" valign="top" width="20%"><code>XPathFactory</code></td>
                                          <td headers="h502" align="left" valign="top" width="10%">false</td>
                                          <td headers="h503" align="left" valign="top" width="70%">Extension functions disabled</td>
                                       </tr>
                                    </tbody>
                                 </table>
                        
<!-- ####################################################### -->

<h6><a name="limiting-entity-expansion">Limiting Entity Expansion</a></h6>

<p>Limit the number of entity expansions by either setting the system property <code>jdk.xml.entityExpansionLimit</code> or the parser property <code>http://apache.org/xml/properties/entity-expansion-limit</code>. Both properties accept <code>java.lang.Integer</code> values. The parser throws a fatal error once it has reached the entity expansion limit. By default, <code>entityExpansionLimit</code> is set to 64,000.</p>

<p>The following command-line example sets the entity expansion limit to 10,000:</p>

<pre>java -DentityExpansionLimit=10000 MyApp</pre>

<p>The following code example sets the entity expansion limit to 10,000:</p>

<pre>System.setProperty("jdk.xml.entityExpansionLimit","10000");</pre>

<p>The following code example sets the parser property <code>http://apache.org/xml/properties/entity-expansion-limit</code>to 10,000:</p>

<pre>DocumentBuilderFactory dfactory = DocumentBuilderFactory.newInstance();
dfactory.setAttribute(
        "http://apache.org/xml/properties/entity-expansion-limit",
        new Integer("10000"));
DocumentBuilder docBuilder = dbFactory.newDocumentBuilder();</pre>
    
<!-- ####################################################### -->

<h6><a name="limiting-the-number-of-element-attributes">Limiting the Number of Element Attributes</a></h6>

<p>Limit the number of attributes in an element by either setting the system property <code>jdk.xml.elementAttributeLimit</code> or by setting the parser property <code>http://apache.org/xml/properties/elementAttributeLimit</code>. Both properties accept <code>Integer</code> values. By default, <code>jdk.xml.elementAttributeLimit</code> is set to 10,000. When the parser property <code>http://apache.org/xml/properties/elementAttributeLimit</code> is set, it overrides the system property. The parser throws a fatal error if the number of attributes in a element exceeds the limit.</p>

<p>The following command-line example sets the element attribute limit to 20:</p>

<pre>java -Djdk.xml.elementAttributeLimit=20 MyApp</pre>

<p>The following code example sets the element attribute limit to 20:</p>

<pre>System.setProperty("jdk.xml.elementAttributeLimit","20");</pre>

<p>The following code example sets the parser property <code>http://apache.org/xml/properties/entity-expansion-limit</code> to 20:</p>

<pre>DocumentBuilderFactory dfactory = DocumentBuilderFactory.newInstance();
dfactory.setAttribute(
    "http://apache.org/xml/properties/elementAttributeLimit",
    new Integer(20));
DocumentBuilder docBuilder = dbFactory.newDocumentBuilder();</pre>

<!-- ####################################################### -->

<h6><a name="limiting-the-number-of-nodes-created-by-constructs-that-contain-maxoccurs">Limiting the Number of Nodes Created by Constructs That Contain maxOccurs</a></h6>

<p>In constructs like <code>xsd:sequence</code>, the validating parser may use space (memory) proportional to the value of the <code>maxOccurs</code> occurrence indicator. This may cause the VM to run out of memory, or simply run for a very long time. To prevent potential attacks that exploit this behavior, enable secure processing on a factory as follows:</p>

<pre>factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, Boolean.TRUE);</pre>

<p>Note that for <code>xsd:element</code> and <code>xsd:any</code>, the validating parser uses a constant amount of space, which is independent of the value of the <code>maxOccurs</code> occurrence indicator.</p>

<p>The default value of <code>jdk.xml.maxOccurLimit</code> is 5000. This system property limits the number of content model nodes that may be created when building a grammar for a W3C XML Schema that contains maxOccurs occurrence indicators with values other than "unbounded".</p>

<!-- ####################################################### -->

<h6><a name="when-to-use-processing-limits">When to Use Processing Limits</a></h6>

<p>When determining which processing limits to apply and what
values to use, at the system level, consider the amount of memory
available for applications and whether XML, XSD, or XSL sources
from untrusted sources are accepted and processed. At the
application level, consider whether certain constructs such as
DTDs are used.</p>

<!-- ####################################################### -->

<p><strong><a name="memory-setting-and-limits">Memory Setting and Limits</a></strong></p>


<p>XML processing can be very memory intensive. The amount of
memory that should be allowed to be consumed depends on the
requirements of the applications in a specific environment.
Processing of malformed XML data must be prevented from consuming
excessive memory.</p>

<p>The default limits are generally set to allow legitimate XML
inputs for most applications with memory usage allowed for a
small hardware system, such as a PC. It is recommended that the
limits are set to the smallest possible values, so that any
malformed input can be caught before it consumes large amounts of
memory.</p>

<p>The limits are correlated, but not entirely redundant. You
should set appropriate values for all of the limits: usually the
limits should be set to a much smaller value than the
default.</p>

<p>For example, <code>ENTITY_EXPANSION_LIMIT</code> and
<code>GENERAL_ENTITY_SIZE_LIMIT</code> can be set to prevent
excessive entity references. But when the exact combination of
the expansion and entity sizes are unknown,
<code>TOTAL_ENTITY_SIZE_LIMIT</code> can serve as a overall
control. Similarly, while <code>TOTAL_ENTITY_SIZE_LIMIT</code>
controls the total size of a replacement text, if the text is a
very large chunk of XML, <code>ENTITY_REPLACEMENT_LIMIT</code>
sets a restriction on the total number of nodes that can appear
in the text and prevents overloading the system.</p>

<!-- ####################################################### -->

<p><strong><a name="estimating-the-limits-using-the-getEntityCountInfo-property">Estimating the Limits Using the getEntityCountInfo Property</a></strong></p>

<p>To help you analyze what values you should set for the limits,
a special property called
<code>http://www.oracle.com/xml/jaxp/properties/getEntityCountInfo</code>
is available. The following code snippet, from <a href="https://docs.oracle.com/javase/tutorial/jaxp/limits/sample.html">
Processing Limit Samples</a> in <cite>The Java Tutorials</cite>, shows an example of using the property:</p>

<pre>public static final String ORACLE_JAXP_PROPERTY_PREFIX =
    "http://www.oracle.com/xml/jaxp/properties/";
// ...
public static final String JDK_ENTITY_COUNT_INFO = 
    ORACLE_JAXP_PROPERTY_PREFIX + "getEntityCountInfo";
// ...
parser.setProperty(JDK_ENTITY_COUNT_INFO, "yes");</pre>

<p>When you run the processing limit sample with the DTD in W3C
MathML 3.0, it prints out the following table:</p>

<table title="Running JAXP Processing Limits Sample with DTD in W3C MatchML 3.0" summary="Table that the JAXP processing limits sample prints when you run it with the DTD in W3C MathML 3.0" frame="hsides" rules="rows" cellspacing="0" cellpadding="4" border="1">
<tbody>
<tr valign="top" align="left">
<th id="h501" valign="top" align="left">Property</th>
<th id="h502" valign="top" align="left">Limit</th>
<th id="h503" valign="top" align="left">Total
Size</th>
<th id="h504" valign="top" align="left">Size</th>
<th id="h505" valign="top" align="left">Entity
Name</th>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>ENTITY_EXPANSION_LIMIT</code></td>
<td headers="h602" valign="top" align="left">64000</td>
<td headers="h603" valign="top" align="left">1417</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>MAX_OCCUR_NODE_LIMIT</code></td>
<td headers="h602" valign="top" align="left">5000</td>
<td headers="h603" valign="top" align="left">0</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>ELEMENT_ATTRIBUTE_LIMIT</code></td>
<td headers="h602" valign="top" align="left">10000</td>
<td headers="h603" valign="top" align="left">0</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>TOTAL_ENTITY_SIZE_LIMIT</code></td>
<td headers="h602" valign="top" align="left">
50000000</td>
<td headers="h603" valign="top" align="left">55425</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>GENERAL_ENTITY_SIZE_LIMIT</code></td>
<td headers="h602" valign="top" align="left">0</td>
<td headers="h603" valign="top" align="left">0</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>PARAMETER_ENTITY_SIZE_LIMIT</code></td>
<td headers="h602" valign="top" align="left">1000000</td>
<td headers="h603" valign="top" align="left">0</td>
<td headers="h604" valign="top" align="left">7303</td>
<td headers="h605" valign="top" align="left">
<code>%MultiScriptExpression</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>MAX_ELEMENT_DEPTH_LIMIT</code></td>
<td headers="h602" valign="top" align="left">0</td>
<td headers="h603" valign="top" align="left">2</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left"><code>MAX_NAME_LIMIT</code></td>
<td headers="h602" valign="top" align="left">1000</td>
<td headers="h603" valign="top" align="left">13</td>
<td headers="h604" valign="top" align="left">13</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
<tr valign="top" align="left">
<td headers="h601" valign="top" align="left">
<code>ENTITY_REPLACEMENT_LIMIT</code></td>
<td headers="h602" valign="top" align="left">3000000</td>
<td headers="h603" valign="top" align="left">0</td>
<td headers="h604" valign="top" align="left">0</td>
<td headers="h605" valign="top" align="left">null</td>
</tr>
</tbody>
</table>

<p>In this example, the total number of entity references, or the
entity expansion, is 1417; the default limit is 64000. The total
size of all entities is 55425; the default limit is 50000000. The
biggest parameter entity is <code>%MultiScriptExpression</code>
with a length of 7303 after all references are resolved; the
default limit is 1000000.</p>
<p>If this is the largest file that the application is expected
to process, it is recommended that the limits be set to smaller
numbers. For example, 2000 for
<code>ENTITY_EXPANSION_LIMIT</code>, 100000 for
<code>TOTAL_ENTITY_SIZE_LIMIT</code>, and 10000 for
<code>PARAMETER_ENTITY_SIZE_LIMIT</code>.</p>

<!-- ####################################################### -->

<h5><a name="extension-functions">Extension Functions</a></h5>

<p>Because FSP is off by default
for <code>Transformer</code> and <code>XPath</code>, extension
functions are allowed. For applications processing documents from
untrusted sources, it is recommended to turn off the extension
functions feature. There are two ways to do so:</p>
<ul>
<li>
<p>By setting FSP to true, for example:</p>
<pre>TransformerFactory tf = TransformerFactory.newInstance();          
tf.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</pre>
</li>
<li>
<p>By setting the <code>enableExtensionFunctions</code> property
to false:</p>
<pre>final static String ENABLE_EXTENSION_FUNCTIONS =
    "http://www.oracle.com/xml/jaxp/properties/enableExtensionFunctions";
// ...
TransformerFactory tf = TransformerFactory.newInstance();  
tf.setFeature(ENABLE_EXTENSION_FUNCTIONS, false);</pre></li>
</ul>
<p>In cases where extension functions are disabled as a result of
installing a Java Security Manager, applications may also choose
to re-enable the extension functions feature by setting the
property <code>enableExtensionFunctions</code> to true. The
following table defines this property:</p>

<!-- ####################################################### -->

<h6><a name="enableExtensionFunctions" id=
"enableExtensionFunctions">enableExtensionFunctions</a></h6>

<table title="enableExtensionFunctions" summary=
"The enableExtensionFunctions property" frame="hsides" rules=
"rows" cellspacing="0" cellpadding="4" border="1">
<thead>
<tr valign="top" align="left">
<th id="h701" valign="bottom" align="left">Attribute</th>
<th id="h702" valign="bottom" align="left">Description</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">Name</td>
<td headers="h702" valign="top" align=
"left">
<code>http://www.oracle.com/xml/jaxp/properties/enableExtensionFunctions</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">
Definition</td>
<td headers="h702" valign="top" align=
"left">Determines whether XSLT and XPath extension functions are
allowed.</td>
</tr>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">Value</td>
<td headers="h702" valign="top" align=
"left">A boolean. True indicates that extension functions are
allowed; False otherwise.</td>
</tr>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">Default
value</td>
<td headers="h702" valign="top" align=
"left">true</td>
</tr>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">System
property</td>
<td headers="h702" valign="top" align=
"left"><code>jdk.xml.enableExtensionFunctions</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h701" valign="top" align="left">Since</td>
<td headers="h702" valign="top" align=
"left">7u60</td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h5><a name="third-party-parsers">Third-Party Parsers</a></h5>

<p>The JDK will always use its system-default parser even when
there's a third-party parser on the classpath. To override the
JDK system-default parser, set the
<code>jdk.xml.overrideDefaultParser</code> property to true.</p>

<!-- ####################################################### -->

<h6><a name="overrideDefaultParser" id="overrideDefaultParser">overrideDefaultParser</a></h6>

<table title="overrideDefaultParser" summary=
"The jdk.xml.overrideDefaultParser property, which enables third-party parsers for the JDK's Transformer, Validator, and XPath implementations"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="h801" valign="bottom" align="left">Attribute</th>
<th id="h802" valign="bottom" align="left">Description</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">Name</td>
<td headers="h802" valign="top" align=
"left"><code>jdk.xml.overrideDefaultParser</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">
Definition</td>
<td headers="h802" valign="top" align=
"left">Enables the use of a third-party's parser implementation
to override the system-default parser for the JDK's
<code>Transformer</code>, <code>Validator</code>, and
<code>XPath</code> implementations. The property can be set
through JAXP factories, System properties, or the
<code>jaxp.properties</code> file.</td>
</tr>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">Value</td>
<td headers="h802" valign="top" align=
"left">A boolean. Setting it to true enables third-party parser
implementations to override the system-default implementation
during XML transformation, XML validation, or XPath operations.
Setting it to false disables the use of third-party parser
implementations. When the value is specified as a String, the
returning value will be that of
<code>Boolean.parseBoolean</code>.</td>
</tr>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">Default
value</td>
<td headers="h802" valign="top" align=
"left">false</td>
</tr>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">System
property</td>
<td headers="h802" valign="top" align=
"left"><code>jdk.xml.overrideDefaultParser</code></td>
</tr>
<tr valign="top" align="left">
<td headers="h801" valign="top" align="left">Since</td>
<td headers="h802" valign="top" align=
"left">6u181, 7u171, 8u161, 9.0.4</td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h6><a name="example-of-using-a-third-party-parser" id=
"example-of-using-a-third-party-parser">Example of Using a
Third-Party Parser</a></h6>

<p>The following code snippets instruct the factories to use a
third-party parser, if found on the classpath, by setting the
<code>jdk.xml.overrideDefaultParser</code> property with the
<code>setFeature</code> method:</p>
<pre>static final String JDK_OVERRIDE_PARSER = "jdk.xml.overrideDefaultParser";
// ...
TransformerFactory tFactory = TransformerFactory.newInstance();
tFactory.setFeature(JDK_OVERRIDE_PARSER, true);
// ...
XPathFactory xf = XPathFactory.newInstance();
xf.setFeature(JDK_OVERRIDE_PARSER, true);
// ...
SchemaFactory schemaFactory =
    SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
schemaFactory.setFeature(JDK_OVERRIDE_PARSER, true);
// ...
Schema schema = schemaFactory.newSchema(new File("mySchema.xsd"));
Validator validator = schema.newValidator();
validator.setFeature(JDK_OVERRIDE_PARSER, true);</pre>

<p>The following code snippet sets
<code>jdk.xml.overrideDefaultParser</code> as a System
property:</p>

<pre>System.setProperty("jdk.xml.overrideDefaultParser", "true"));</pre>

<p>You can add the following line to the
<code>jaxp.properties</code> file to enable third-party
parsers:</p>

<pre>jdk.xml.overrideDefaultParser=true</pre>

<!-- ####################################################### -->

<h5><a name="disabling-dtd-processing">Disabling DTD Processing</a></h5>

<p>If your applications don't require DTDs, then consider
disabling DTD processing to safeguard against many common
DTD-related attacks, including denial-of-service, XML external
entity (XXE), and server-side request forgery (SSRF).</p>

<!-- ####################################################### -->


<h6><a name="disabling-dtd-processing-for-sax-and-dom-parsers">Disabling DTD Processing for SAX and DOM Parsers</a></h6>

<p>To disable DTD processing for SAX and DOM parsers, set the
feature
<code>http://apache.org/xml/features/disallow-doctype-decl</code>
to true through a factory. The following code snippet disables
DTDs for SAX parsers. A fatal error is thrown if the incoming XML
document contains a DOCTYPE declaration.</p>
<pre>final static String DISALLOW_DTD =
    "http://apache.org/xml/features/disallow-doctype-decl";
// ...
SAXParserFactory spf = SAXParserFactory.newInstance();      
spf.setFeature(DISALLOW_DTD, true);</pre>

<!-- ####################################################### -->

<h6><a name="disabling-dtd-processing-for-stax-processors">Disabling DTD Processing for StAX Parsers</a></h6>

<p>To disable DTD processing for StAX parsers, set the property
<code>SupportDTD</code> with the
<code>XMLInputFactory.setProperty</code> method:</p>
<pre>XMLInputFactory xif = XMLInputFactory.newInstance();
xif.setProperty(XMLInputFactory.SUPPORT_DTD, Boolean.FALSE);</pre>

<!-- ####################################################### -->

<h3><a name="composite-processors">Composite Processors</a></h3>

<p>Composite processors such as the validator, transformer, and XPath processor use internally created parsers to read the source when it's not a <code>DOMSource</code> or <code>Document</code>. When <code>FEATURE_SECURE_PROCESSING</code> (FSP) is turned on through factories such as <code>SchemeFactory</code>, <code>TransformerFactory</code>, and <code>XPathFactory</code>, it's also on for any internal parser instance. This means the internal parser will behave the same as a parser created through <code>SAXParserFactory</code> or <code>DocumentBuilderFactory</code>.</p>

<p>For example, the following code creates an instance of <code>XPathFactory</code> with FSP:</p>

<pre>XPathFactory xf = XPathFactory.newInstance(); 
xf.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</pre>

<p>This process ensures FSP is also on for any internal parser required by the XPath processor, such as when it's used to evaluate raw XML source. Consequently, any restrictions defined by the parser are applied. For instance, if the XML source contains external references not resolved by a catalog or resolver, it will be rejected as described in <a href="#external-access-properties">External Access Properties</a> because FSP is turned on explicitly. 

<!-- ####################################################### -->

<h3><a name="using-java-xml-resolvers">Using Java XML Resolvers</a></h3>

<p>You can register custom resolvers and catalogs on a JDK XML processor to intercept any references to external resources and resolve them with local ones. This feature eliminates the need to read and access external resources, thus helping to remove a source of potential risk.</p>

<p>The Java XML API supports various resolvers that you can register on JDK XML processors to resolve external resources. These resolvers includes entity resolvers for SAX and DOM parsers, XML resolvers for StAX parsers, <code>LSResourceResolver</code> for validation, and <code>URIResolver</code> for transformation.</p>

<!-- ####################################################### -->

<h4><a name="entity-resolvers-for-sax-and-dom">Entity Resolvers for SAX and DOM</a></h4>

<p>SAX defines an interface that DOM also supports,
<code>org.xml.sax.EntityResolver</code>. It enables applications
to step into the entity resolution process and perform entity
resolution on their own terms. The following is the interface's
definition:</p>

<pre>package org.xml.sax;

public interface EntityResolver {
    public InputSource resolveEntity(String publicID, String systemID)
        throws SAXException;
}</pre>

<p>You can then register an implementation of the interface on a
SAX driver:</p>

<pre>EntityResolver resolver = ...;
SAXParserFactory factory = SAXParserFactory.newInstance();
factory.setNamespaceAware(true);
XMLReader reader = factory.newSAXParser().getXMLReader();
reader.setEntityResolver(resolver);</pre>

<p>Alternatively, you can register it on a DOM builder:</p>

<pre>DocumentBuilder builder =
    DocumentBuilderFactory.newInstance().newDocumentBuilder();       
docBuilder.setEntityResolver(resolver);</pre>

<!-- ####################################################### -->

<h4><a name="xmlresolver-for-stax">XMLResolver for StAX</a></h4>

<p>StAX defines a <code>javax.xml.stream.XMLResolver</code> interface:</p>

<pre>package javax.xml.stream;

public interface XMLResolver {
    public Object resolveEntity(
        String publicID, String systemID,
        String baseURI, String namespace)
        throws XMLStreamException;
}</pre>

<p>You can register it on a StAX factory:</p>

<pre>XMLResolver resolver = ...;
XMLInputFactory xif = XMLInputFactory.newInstance();
xif.setProperty(XMLInputFactory.RESOLVER, resolver);</pre>

<!-- ####################################################### -->

<h4><a name="uriresolver-for-transform">URIResolver for javax.xml.transform</a></h4>

<p>The <code>javax.xml.transform</code> API supports custom resolution of external resources through the
<code>URIResolver</code> interface:</p>

<pre>package javax.xml.transform;

public interface URIResolver {
    public Source resolve(String href, String base)
        throws TransformerException;
}</pre>

<p>You can register an implementation of <code>URIResolver</code>
on a <code>Transformer</code> as follows:</p>

<pre>URIResolver resolver = ...;
TransformerFactory tf = TransformerFactory.newInstance();
Transformer t = tf.newTransformer(
    new StreamSource(new StringReader("xsl source")));
t.setURIResolver(resolver);</pre>

<!-- ####################################################### -->

<h4><a name="lsresource-resolver-for-validation">LSResourceResolver for javax.xml.validation</a></h4>

<p>The <code>javax.xml.validation</code> API supports Document
Object Model Level 3 Load and Save (DOM LS) DOM through the
<code>LSResourceResolver</code> interface:</p>

<pre>package org.w3c.dom.ls;

public interface LSResourceResolver {
    public LSInput resolveResource(
        String type, String namespaceURI, String publicId,
        String systemId, String baseURI);
}</pre>

<p>You can register an implementation of <code>LSResourceResolver</code> on a <code>SchemaFactory</code>
as follows:</p>

<pre>SchemaFactory schemaFactory =
    SchemaFactory.newInstance("http://www.w3.org/2001/XMLSchema");
LSResourceResolver resolver = ...;
schemaFactory.setResourceResolver(resolver);</pre>

<!-- ####################################################### -->

<h2><a name="relationship-with-security-manager">Relationship with Security Manager</a></h2>

<p>JAXP properties are checked first before a connection is
attempted, whether or not a <code>SecurityManager</code> is
present. This means that a connection may be blocked even if it
is granted permission by the <code>SecurityManager</code>. For
example, if the JAXP properties are set to disallow the HTTP
protocol, then they will effectively block any connection attempt
even when an application has a <code>SocketPermission</code>.</p>
<p>For the purpose of restricting connections, the
<code>SecurityManager</code> can be viewed as being at a lower
level. Permissions are checked after JAXP properties are
evaluated. For example, if an application does not have a
<code>SocketPermission</code>, then a
<code>SecurityException</code> will be thrown even if JAXP
properties are set to allow HTTP connections.</p>
<p>When a <code>SecurityManager</code> is present, Feature for
Secure Processing (FSP) is set to true. This behavior does not
turn on any external access restrictions.</p>

<!-- ####################################################### -->

<h2><a name="handling-errors-from-jaxp-properties">Handling Errors from JAXP Properties</a></h2>

<p>It is recommended that applications catch
<code>org.xml.sax.SAXNotRecognizedException</code> when setting
JAXP properties so that the applications will work properly on
older releases that don't support them.</p>
<p>For example, the following method,
<code>isNewPropertySupported</code>, from <a href=
"https://docs.oracle.com/javase/tutorial/jaxp/limits/sample.html">
Processing Limit Samples</a> in <cite>The Java Tutorials</cite>, detects if the sample
is run with a version of the JDK that supports the
<code>JDK_GENERAL_ENTITY_SIZE_LIMIT</code> property:</p>

<pre>public boolean isNewPropertySupported() {
    try {
        SAXParser parser = getSAXParser(false, false, false);
        parser.setProperty(JDK_GENERAL_ENTITY_SIZE_LIMIT, "10000");
    } catch (ParserConfigurationException ex) {
        fail(ex.getMessage());
    } catch (SAXException ex) {
        String err = ex.getMessage();
        if (err.indexOf("Property '" + JDK_GENERAL_ENTITY_SIZE_LIMIT +
                                       "' is not recognized.") &gt; -1) {
            // expected before this patch
            debugPrint("New limit properties not supported. Samples not run.");
            return false;
        }
    }
    return true;
}</pre>

<p>When input files contain constructs that cause an
over-the-limit exception, applications may check the error code
to determine the nature of the failure. The following error codes
are defined for processing limits:</p>

<ul>
<li><code>EntityExpansionLimit</code>: JAXP00010001</li>
<li><code>ElementAttributeLimit</code>: JAXP00010002</li>
<li><code>MaxEntitySizeLimit</code>: JAXP00010003</li>
<li><code>TotalEntitySizeLimit</code>: JAXP00010004</li>
<li><code>MaxXMLNameLimit</code>: JAXP00010005</li>
<li><code>maxElementDepth</code>: JAXP00010006</li>
<li><code>EntityReplacementLimit</code>: JAXP00010007</li>
</ul>

<p>The error code has the following format:</p>
<pre>"JAXP" + <em>components (two digits)</em> + <em>error category (two digits)</em> + <em>sequence number</em></pre>

<p>The code JAXP00010001, therefore, represents the JAXP base
parser security limit <code>EntityExpansionLimit</code>.</p>
<p>If access to external resources is denied due to the
restrictions set by external access restrictions, then an
exception will be thrown with an error in the following
format:</p>
<pre><em>[type of construct]</em>: Failed to read <em>[type of construct]</em>
    "<em>[name of the external resource]</em>", because "<em>[type of restriction]</em>"
    access is not allowed due to restriction set by the
    <em>[property name]</em> property.</pre>
<p>For example, suppose the following:</p>
<ul>
<li>
<p>The <code>ACCESS_EXTERNAL_DTD</code> JAXP property is set as
follows:</p>
<pre>parser.setProperty(
    "http://javax.xml.XMLConstants/property/accessExternalDTD", "file");</pre></li>
<li>
<p>Your application tries to fetch an external DTD with the HTTP
protocol.</p>
</li>
<li>
<p>The parser parsed an XML file that contains an external
reference to
<code>http://www.example.com/dtd/properties.dtd</code>.</p>
</li>
</ul>
<p>The error message would look like the following:</p>
<pre>External DTD: Failed to read external DTD
    "http://www.example.com/dtd/properties.dtd", because "http"
    access is not allowed due to restriction set by the
    accessExternalDTD property.</pre>

<!-- ####################################################### -->    
    
<h2><a name="streaming-api-for-xml-and-jaxp-properties">Streaming API for XML and JAXP Properties</a></h2>

<p>Streaming API for XML (StAX), JSR 173, does not support FSP nor does it support EAPs. However, JDK's StAX implementation supports processing limits, and StAX in the context of JAXP supports EAPs.</p>

<!-- ####################################################### -->

<h3><a name="stax-and-processing-limits">StAX and Processing Limits</a></h3>

<p>JDK's StAX implementation supports processing limits and their
corresponding System properties. However, because FSP is not
supported, you can't turn on or off processing limits for StAX by
turning on or off FSP. Processing limits continue to behave as
described in <a href=
"#jaxp-properties-for-processing-limits">JAXP Properties for
Processing Limits</a>.</p>

<!-- ####################################################### -->

<h3><a name="stax-and-external-access-properties">StAX and External Access Properties</a></h3>

<p>JDK's StAX implementation supports the JAXP properties related
to External Access Properties (EAPs). Setting them is similar to SAX
or DOM, but through the <code>XMLInputFactory</code> class, for
example:</p>

<pre>XMLInputFactory xif = XMLInputFactory.newInstance();
xif.setProperty(
    "http://javax.xml.XMLConstants/property/accessExternalDTD",
    "file");</pre>

<p>For compatibility, StAX properties and features take precedence over the processing limit and external access restriction properties. For example, the <code>SupportDTD</code> property, when set to <code>false</code>, causes a program to throw an exception when an input file contains a DTD before it can be parsed. Therefore, processing limits and external access restrictions on DTDs will have no effect on applications that have disabled DTDs by setting the <code>SupportDTD</code> property to <code>false</code>.</p>

<!-- ####################################################### -->

<h2><a name="general-recommendations-for-jaxp-security">General Recommendations for JAXP Security</a></h2>

<p>The following are general recommendations for configuring JAXP
properties and features to help secure your applications and
systems:</p>

<ul>
<li>Turn on <code>FEATURE_SECURE_PROCESSING</code> (FSP), then adjust
individual features and properties in accordance with your
specific requirements.</li>

<li>For processing limits, adjust them so that they are just
large enough to accommodate the maximum amount your applications
require.</li>

<li>For External Access Restrictions (EAPs), reduce or eliminate your
applications' reliance on external resources, including the use
of resolvers, then tighten these restrictions.</li>

</ul>

<!-- ####################################################### -->

<h2><a name="appendix-a">Appendix A: Glossary of Java API for XML Processing Terms and Definitions</a></h2>

<table title="JAXP Glossary" summary=
"Glossary of Java API for XML Processing Terms and Definitions"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="d135600e2588" valign="bottom" align="left">Term</th>
<th id="d135600e2590" valign="bottom" align="left">Definition</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">JAXP</td>
<td headers="h902" valign="top" align=
"left">Java API for XML Processing</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">Java SE XML
API</td>
<td headers="h902" valign="top" align=
"left">APIs defined in the JAXP JSR and integrated into Java
SE</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">Java XML
API</td>
<td headers="h902" valign="top" align=
"left">Equivalent term for Java SE XML API</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">Java XML
Features and Properties</td>
<td headers="h902" valign="top" align=
"left">XML-related features and properties defined by the Java SE
specification</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">JDK XML</td>
<td headers="h902" valign="top" align=
"left">The JDK implementation of the Java XML API</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">JDK XML
Parsers</td>
<td headers="h902" valign="top" align=
"left">The JDK implementation of the XML parsers</td>
</tr>
<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">JDK XML
Properties</td>
<td headers="h902" valign="top" align=
"left">The JDK Implementation-only properties</td>
</tr>

<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">EAPs</td>
<td headers="h902" valign="top" align=
"left"><a href="#external-access-properties">External Access Properties</a></td>
</tr>

<tr valign="top" align="left">
<td headers="h901" valign="top" align="left">FSP</td>
<td headers="h902" valign="top" align=
"left"><a href="#the-feature-security-processing-security-directive">The FEATURE_SECURE_PROCESSING Security Directive</a></td>
</tr>
</tbody>
</table>

<!-- ####################################################### -->

<h2><a name="appendix-b">Appendix B: Java and JDK XML Features and Properties Naming Convention</a></h2>

<p>Java and JDK XML features and properties are defined in the
<code>javax.xml.XMLConstants</code> class. The features have a
prefix <code>http://javax.xml.XMLConstants/feature</code>, the
properties <code>http://javax.xml.XMLConstants/property</code>.
If there is a corresponding System property, its prefix is
<code>javax.xml</code>.</p>
<p>The JDK XML properties are JDK implementation-only properties.
Their prefixes vary depending on the JDK version. The following
table summarizes this naming convention:</p>
<table title=
"Java and JDK XML Features and Properties Naming Convention"
summary=
"Summarizes this naming convention for Java and JDK XML features and properties"
frame="hsides" rules="rows" cellspacing="0" cellpadding="4"
border="1">
<thead>
<tr valign="top" align="left">
<th id="d135600e2694" valign="bottom" align="left">Scope</th>
<th id="d135600e2696" valign="bottom" align="left">API Property Prefix</th>
<th id="d135600e2698" valign="bottom" align="left">System Property Prefix</th>
<th id="d135600e2700" valign="bottom" align="left">Java SE and JDK Version</th>
</tr>
</thead>
<tbody>
<tr valign="top" align="left">
<td headers="h1001" valign="top" align="left">Java SE</td>
<td headers="h1002" valign="top" align=
"left"><code>http://javax.xml.XMLConstants/feature</code><br />
<code>http://javax.xml.XMLConstants/property</code></td>
<td headers="h1003" valign="top" align=
"left"><code>javax.xml</code></td>
<td headers="h1004" valign="top" align=
"left">Since 1.4</td>
</tr>
<tr valign="top" align="left">
<td headers="h1001" valign="top" align="left">JDK</td>
<td headers="h1002" valign="top" align=
"left">
<code>http://www.oracle.com/xml/jaxp/properties</code></td>
<td headers="h1003" valign="top" align=
"left"><code>jdk.xml</code></td>
<td headers="h1004" valign="top" align=
"left">Since 7</td>
</tr>
</tbody>
</table>

<!--  footer start -->
<div id="javasefooter">
<div class="hr">
<hr /></div>
<div id="javasecopyright">
<img id="oraclelogofooter" src=
"../../../../images/oraclelogo.gif" alt="Oracle and/or its affiliates"
border="0" width="100" height="29" name=
"oraclelogofooter" />

<a href="../../../../legal/cpyr.html">Copyright
&#169;</a> 1993, 2025, Oracle and/or its affiliates. All rights
reserved.</div>
<div id="javasecontactus">
<a href=
"http://docs.oracle.com/javase/feedback.html">Contact
Us</a>
</div>
</div>
<!-- footer end -->

<!-- STATIC FOOTER -->

</body>
</html>
